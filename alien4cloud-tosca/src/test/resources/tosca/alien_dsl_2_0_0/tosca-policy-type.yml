tosca_definitions_version: alien_dsl_2_0_0

metadata:
  template_name: policy-parsing-test
  template_author: alien4cloud
  template_version: 2.0.0-SNAPSHOT

description: This is an example of a single line description (no folding).

imports:
  - tosca-normative-types:1.0.0-ALIEN14

policy_types:
  org.alien4cloud.sample.MinimalPolicyType:
    derived_from: tosca.policies.Root
    description: This is a sample policy type with minimal definition

  org.alien4cloud.sample.SimpleConditionPolicyType:
    derived_from: tosca.policies.Root
    description: This is a sample policy type with simple definition
    metadata:
      sample_meta: a meta data
      anoter_meta: another meta data
    properties:
      sample_property:
        type: string
    targets: ["tosca.nodes.Compute", "org.alien4cloud.Group"]
    triggers:
      default:
        description: This is the trigger of the sample policy
        event_type: cpu
        schedule:
          start_time: 2016-04-04-15T00:00:00Z
          end_time: 2020-04-04-15T00:00:00Z
        action: scale

  org.alien4cloud.sample.PolicyType:
    derived_from: tosca.policies.Root
    description: This is a sample policy type
    metadata:
      sample_meta: a meta data
      anoter_meta: another meta data
    properties:
      sample_property:
        type: string
    targets: ["tosca.nodes.Compute", "org.alien4cloud.groups.SampleGroup"]
    triggers:
      default:
        description: This is the trigger of the sample policy
        # Actually cpu_usage should be a metric of the compute somehow.
        event_type: "cpu_usage"
        schedule:
          start_time: 2016-04-04-15T00:00:00Z
          end_time: 2020-04-04-15T00:00:00Z
        target_filter:
          # This filter is applied only on the tosca.nodes.Compute, either direct target either for tosca.nodes.Compute nodes that are part of the org.alien4cloud.groups.SampleGroup group
          node: "tosca.nodes.Compute"
        condition:
          constraints:
            - greater_than: 80
          period: 60s # condition should remain true for 60 seconds
          evaluations: 3 # There should be at least 3 evaluations of the condition
          method: average # Compute on an average basis: so if there is a 80% cpu usage average during 60sec and that 3 times consecutive
        action: dosomething.sh # trigger an operation on the manager

# What is actually missing here is the ability to ask instance creations (in initial state) on a workflow
# So when I scale how to instruct that I want the action applied to a new target rather than existing target ?
# Should we add it on the workflow side or on the policy side ?